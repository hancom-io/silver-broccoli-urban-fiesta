---

title: 구글 신은 모든 것을 알고 있다.

author: 윤명

author_id: hnc-myoon

tag: 

- google
- GDI
- GDI+
- 렌더링

excerpt: 개발을 하다가 힘이 들 때는 구글에 의지하자.

---

<br>

## 서론

---

  내가 개발자가 된 지 얼마 안 되었을 때의 일이다. 반년 정도 기간의 프로젝트를 진행하게 되었는데 구체적인 내용은 이러하다. 투명한 배경을 가진 이미지에 텍스트를 가진 개체를 렌더링하여 이미지 레이어를 만들어 내는 것이었다. 

우선 윈도우에서 이미지를 렌더링하기 위해 사용하는 API를 소개해야 할 것 같다 이미지를 렌더링 하기 위해서는 GDI 와 GDI+ 라는 API가 사용되는데 위키피디아를 검색해보면 아래의 설명을 찾을 수 있다.

![GDI 설명]({{site.assets}}/2021/2021-06-21-gdi.jpg)

> GDI+는 아래와 같다

![GDI Plus 설명]({{site.assets}}/2021/2021-06-21-gdiplus.jpg)

## 문제

---

당시 나는 WIN32 API 중 일부인 GDI에 대한 깊은 이해가 없었기 때문에 투명한 이미지를 구현하기 위해서는 TransparentBlt 함수를 사용해야 한다고 알고 있었지만 이 함수는 특정 RGB 값 하나를 희생하여 그 RGB 값을 투명한 색으로 지정하는 방식이라 절대 제품에 사용될 수 없는 함수였다 그래서 나는 인터넷을 리서치하여 GDI의 HBITMAP 과는 별개로 GDI+ 의 Gdiplus::Bitmap을 사용하면 투명한 배경을 지원하는 이미지를 만들어 낼 수 있다는 사실을 알게 되었고 그렇게 순조롭게 진행이 되는 줄 알았다. 하지만 이상하게도 개체들은 깔끔하게 렌더링 되는데 텍스트는 물감이 번진 수채화처럼 지저분하게 나타나는 것이 아닌가. 

![더러운 이미지]({{site.assets}}/2021/2021-06-21-dirty-image.jpg)![깨긋한 이미지]({{site.assets}}/2021/2021-06-21-clear-image.jpg)

> 번져 보이는 이미지(좌측)와 정상 이미지(우측)

나는 내가 API를 잘못 사용하였거나 다른 렌더링 방법이 있을 거로 생각하였고 그때부터 비주얼 스튜디오와 나와의 길고도 지루한 싸움이 시작되었다. 한셀에 구현된 GDI+ Wrapping 클래스들을 디버깅하면서 코드를 이렇게도 해보고 저렇게도 해보고 그러다 안되어서 Stack Overflow 라는 유명한 개발자 커뮤니티의 글까지 해석하면서 모든 방법을 총동원하였다. 그중에 지금도 기억이 나는 방법은 꽤 복잡한 방법이었는데 버퍼함수를 이용해서 GDI+의 투명 비트맵을 직접 구현하는 방법으로 마지막 기대를 해보았지만, 이 역시도 정답은 아니었다. 그렇게 시간이 흐르고 흘러 작업은 한없이 지연되고 있었고 나는 자포자기 상태에 이르게 되었다. 구글 검색기록을 보면 정말 다양한 검색 시도가 있었으며 방문하지 않았던 웹사이트가 없었다.

## 해결 

---

![구하라 그러면 얻을 것이다.]({{site.assets}}/2021/2021-06-21-seek.jpg){: width="900"} 

나는 마지막으로 이미지를 검색해 보기로 마음먹었다. “그래 누군가 나와 비슷한 사례가 있었을 거야…." 라고 생각하면서 말이다. 그렇게 30분쯤 찾았을 때 나는 아래와 같은 이미지를 발견 할 수 있었다. 

![인터넷에서 찾은 이미지]({{site.assets}}/2021/2021-06-21-blur-image.jpg)

> (저작권 문제가 있을 수 있어 Blur 처리하였다.)

그렇다. 투명한 배경 위에 GDI 텍스트 렌더링 함수로 텍스트를 그리게 되면 지저분하게 렌더링이 된다는 것이었다. 다시 말하자면 해결 방법이 없는 문제를 해결하려고 애쓰고 있었는데 결국 구글이 정답을 알려준 셈이다. 결국 나는 이미지 레이어를 만들어 낼 수 없었지만, 구글이 현재 애플리케이션 텍스트 렌더링 구조상 추가 진행이 불가능하다는 것을 알려준 덕에 더 이상 리서치에 시간을 허비하지 않고 다른 방법으로 우회하여 프로젝트를 성공적으로 마무리 지을 수 있었다.

  

개발을 하다 보면 정말 온갖 난관에 부딪히게 된다. 코드를 디버깅하다가 잘 모르겠을 때는 로그를 보고 수정한 사람이나 현 담당자에게 질문하면 되지만 개발을 하다 보면 코드를 작성하는 것뿐만 아니라 개발환경 세팅이나 개발에 필요한 툴 사용법에 대해서 알아야 할 필요가 있을 때가 있다. 그때마다 일하고 있는 바쁜 사람 붙잡아서 도와달라고 할 수 없지 않은가. 이런 일들이 반복되면 끝이 보이지 않는 긴 터널을 지나는 것 같고 때로는 너무 지쳐서 번 아웃이 오기도 한다. 하지만 그럴 때마다 좌절하지 말고 경건한 마음으로 두 손을 키보드에 올려놓은 뒤 구글 신께 기도해 보자. 구글 신은 모든 것을 알고 있다.